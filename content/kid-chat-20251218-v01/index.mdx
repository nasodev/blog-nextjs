---
title: "WEB CHATì„ Vite + TypeScriptë¡œ ê°œë°œ(ë°°í¬ê¹Œì§€)"
publishedAt: "2025-12-18 10:00:00"
updatedAt: "2025-12-18 10:00:00"
description: "í•¸ë“œí° ì—†ëŠ” ì•„ì´ë“¤ì„ ìœ„í•œ ê°€ì¡± ì±„íŒ… ì•±ì„ Vite + TypeScript + Firebaseë¡œ í˜„ëŒ€í™”í•˜ê³ , Ubuntu + Nginx + PM2 + HTTPS ìš´ì˜ ë°°í¬ í™˜ê²½ê¹Œì§€ êµ¬ì„±í•œ ì‹¤ì „ ê°€ì´ë“œ"
image: "../../public/blog-cover/kid-chat-20251218-v01.jpg"
author: "fundev"
isPublished: true
tags:
  - Vite
  - TypeScript
  - Firebase
  - Chat
---

# Web Chatì„ Vite + TypeScriptë¡œ ê°œë°œ(ë°°í¬ê¹Œì§€)

> ëª©í‘œ: ë°”ë‹ë¼ ì±„íŒ… ì•±ì„ **Vite + TypeScript** ê¸°ë°˜ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ê³ , ìš´ì˜ ë°°í¬ í™˜ê²½(**Ubuntu + Nginx + PM2 + HTTPS + GITHUB ACTIONS**)ê¹Œì§€ êµ¬ì„±í•˜ê¸°

---

## 0) Web Chatì´ë€?

**"ì•„ë¹ , ë‚˜ë„ ì¹´í†¡í•˜ê³  ì‹¶ì–´!"**

ì•„ì´ë“¤ì´ í•¸ë“œí°ì´ ì—†ì–´ì„œ ê°€ì¡±ë“¤ê³¼ ë©”ì‹œì§€ë¥¼ ì£¼ê³ ë°›ì„ ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì— ì•„ì‰¬ì›Œí–ˆë‹¤. íƒœë¸”ë¦¿ì´ë‚˜ ì»´í“¨í„°ëŠ” ìˆì§€ë§Œ, ì¹´ì¹´ì˜¤í†¡ ê°™ì€ ë©”ì‹ ì €ëŠ” í•¸ë“œí° ë²ˆí˜¸ê°€ í•„ìš”í•˜ë‹¤.

ê·¸ë˜ì„œ ì§ì ‘ ë§Œë“¤ì—ˆë‹¤.
- í•¸ë“œí° ì—†ì´ **íƒœë¸”ë¦¿ì´ë‚˜ ì»´í“¨í„°ì˜ ì›¹ë¸Œë¼ìš°ì €**ë§Œ ìˆìœ¼ë©´ ì‚¬ìš© ê°€ëŠ¥
- ê°€ì¡±ë¼ë¦¬ë§Œ ì“°ëŠ” **í”„ë¼ì´ë¹— ì±„íŒ…ë°©**
- ì•„ì´ë“¤ ì´ë¦„ì— ë§ì¶˜ **ê·€ì—¬ìš´ ìƒ‰ìƒ** ì§€ì •
- ìƒˆ ë©”ì‹œì§€ê°€ ì˜¤ë©´ **í‘¸ì‹œ ì•Œë¦¼**ìœ¼ë¡œ ì•Œë ¤ì¤Œ

ì²˜ìŒì—ëŠ” ë‹¨ìˆœíˆ HTML + JavaScriptë¡œ ë¹ ë¥´ê²Œ ë§Œë“¤ì—ˆëŠ”ë°, ê¸°ëŠ¥ì´ ëŠ˜ì–´ë‚˜ë©´ì„œ ì½”ë“œê°€ ë³µì¡í•´ì¡Œë‹¤. ì´ë²ˆì— **Vite + TypeScript**ë¡œ êµ¬ì¡°ë¥¼ í˜„ëŒ€í™”í•˜ë©´ì„œ ê·¸ ê³¼ì •ì„ ê¸°ë¡í•œë‹¤.

---

## 1) ì™œ Vite + TypeScriptì¸ê°€

ì´ë²ˆ ì‘ì—…ì—ì„œ í”„ë ˆì„ì›Œí¬ë¥¼ ë°”ë¡œ ë„ì…í•˜ì§€ ì•Šì€ ì´ìœ ëŠ” ë‹¨ìˆœí•˜ë‹¤.
**"í”„ë ˆì„ì›Œí¬ ì´ì „ì—, í”„ë¡ íŠ¸ ê°œë°œì˜ ê¸°ë³¸ê¸°(ëª¨ë“ˆ/ë¹Œë“œ/íƒ€ì…)ë¥¼ ê°–ì¶˜ êµ¬ì¡°"**ê°€ ë¨¼ì € í•„ìš”í–ˆê¸° ë•Œë¬¸ì´ë‹¤.

- **Vite**: ê°œë°œ ì„œë²„(HMR) + í”„ë¡œë•ì…˜ ë¹Œë“œ(ìµœì í™”)ê¹Œì§€ ì±…ì„ì§€ëŠ” íˆ´ì²´ì¸
- **TypeScript**: ëŸ°íƒ€ì„ ì´ì „(ê°œë°œ/ë¹Œë“œ ë‹¨ê³„)ì—ì„œ ì˜¤ë¥˜ë¥¼ ì¡ì•„ì£¼ëŠ” íƒ€ì… ì‹œìŠ¤í…œ
- í”„ë ˆì„ì›Œí¬ ì—†ì´ë„ êµ¬ì¡°í™”ê°€ ê°€ëŠ¥í•˜ê³ , ì´í›„ Vue/Reactë¡œ í™•ì¥í•  ë•Œë„ ê¸°ë°˜ ì§€ì‹ì´ ê·¸ëŒ€ë¡œ ì¬ì‚¬ìš©ëœë‹¤.

---

## 2) Vite ê¸°ì´ˆ â€” "ê°œë°œ ì„œë²„ + ë¹Œë“œ ë„êµ¬"ë¥¼ í•œ ë²ˆì—

### 2.1 Viteê°€ í•˜ëŠ” ì¼ ë‘ ê°€ì§€

ViteëŠ” ê°œë°œ ë‹¨ê³„ì™€ ë°°í¬ ë‹¨ê³„ë¥¼ ê°ê° ìµœì í™”í•œë‹¤.

#### (1) ê°œë°œ ëª¨ë“œ: `npm run dev`
- ë¡œì»¬ ê°œë°œ ì„œë²„ ì‹¤í–‰
- íŒŒì¼ ìˆ˜ì • ì‹œ **ì¦‰ì‹œ ë°˜ì˜(HMR: Hot Module Replacement)**
- ES ëª¨ë“ˆ ê¸°ë°˜ì´ë¼ **import/export íë¦„ì´ ìì—°ìŠ¤ëŸ½ë‹¤**

#### (2) ë°°í¬ ë¹Œë“œ: `npm run build`
- í”„ë¡œì íŠ¸ë¥¼ ìµœì í™”í•´ì„œ `dist/` í´ë”ë¡œ ì¶œë ¥
- íŠ¸ë¦¬ì‰ì´í‚¹(ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì½”ë“œ ì œê±°), ì••ì¶•, í•´ì‹œ íŒŒì¼ëª… ì²˜ë¦¬ ë“±
- ì†ŒìŠ¤ë§µ ìƒì„± ê°€ëŠ¥(ë””ë²„ê¹…ì— ë„ì›€)

> ì‰½ê²Œ ë§í•˜ë©´, **ê°œë°œí•  ë•Œ ë¹ ë¥´ê³ **, ë°°í¬í•  ë•Œ **ìµœì í™”ëœ ê²°ê³¼ë¬¼ì„ ë§Œë“¤ì–´ì¤€ë‹¤.**

### 2.2 Viteì—ì„œ `index.html`ì´ ì¤‘ìš”í•œ ì´ìœ 

Vite í”„ë¡œì íŠ¸ì—ì„œ `index.html`ì€ ë‹¨ìˆœí•œ HTMLì´ ì•„ë‹ˆë¼ **ì•±ì˜ ì‹œì‘ì (ì—”íŠ¸ë¦¬)** ì´ë‹¤.

```html
<script type="module" src="/src/main.ts"></script>
```

ì´ í•œ ì¤„ì„ ê¸°ì¤€ìœ¼ë¡œ ViteëŠ”:
1. `/src/main.ts` ë¡œë”©
2. main.tsê°€ importí•œ íŒŒì¼ë“¤ì„ ì¶”ì 
3. ì „ì²´ ì˜ì¡´ì„± ê·¸ë˜í”„ë¥¼ êµ¬ì„±í•´ì„œ ê°œë°œ/ë¹Œë“œë¥¼ ì²˜ë¦¬

ì¦‰, `index.html â†’ main.ts â†’ ëª¨ë“ˆë“¤` íë¦„ì´ Viteì˜ ê¸°ë³¸ êµ¬ì¡°ë‹¤.

### 2.3 src/ì™€ public/ì˜ ì°¨ì´ (ì‹¤ë¬´ì—ì„œ ë§¤ìš° ì¤‘ìš”)

**src/ëŠ” "ë²ˆë“¤ë§ ëŒ€ìƒ"**
- TypeScript/JavaScript/CSSë¥¼ importí•˜ë©° ì—°ê²°
- Viteê°€ ë¶„ì„í•˜ê³  ìµœì í™”í•œë‹¤

**public/ì€ "ê·¸ëŒ€ë¡œ ë³µì‚¬ë˜ëŠ” ì •ì  íŒŒì¼"**
- ë¹Œë“œ ì‹œ ê°€ê³µ ì—†ì´ dist ë£¨íŠ¸ë¡œ ë³µì‚¬
- ê°œë°œ ì„œë²„ì—ì„œë„ /íŒŒì¼ëª…ìœ¼ë¡œ ê·¸ëŒ€ë¡œ ì ‘ê·¼ ê°€ëŠ¥

ì™œ ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ public/ì— ë‘ëƒë©´:
- ì„œë¹„ìŠ¤ ì›Œì»¤ëŠ” ê²½ë¡œ/ìŠ¤ì½”í”„ê°€ ë¯¼ê°í•˜ê³ 
- ì¢…ì¢… "ë£¨íŠ¸ ê²½ë¡œì— íŠ¹ì • íŒŒì¼ëª…"ì´ ìš”êµ¬ë˜ê¸° ë•Œë¬¸ì´ë‹¤

â†’ `public/firebase-messaging-sw.js`ê°€ ê°€ì¥ ì•ˆì •ì ì¸ ì„ íƒ

### 2.4 alias(@)ëŠ” ì™œ í•„ìš”í•œê°€?

ì½”ë“œê°€ ì»¤ì§€ë©´ ìƒëŒ€ê²½ë¡œê°€ ì§€ì €ë¶„í•´ì§„ë‹¤.

```typescript
import { initFCM } from '../../../firebase/fcm'  // ğŸ˜µ
```

aliasë¥¼ ì“°ë©´:

```typescript
import { initFCM } from '@/firebase/fcm'        // ğŸ™‚
```

**ì£¼ì˜í•  ì :**
- ViteëŠ” `vite.config.ts`ì˜ aliasë¥¼ ë³´ê³ ,
- TypeScript/IDEëŠ” `tsconfig.json`ì˜ pathsë¥¼ ë³¸ë‹¤.

ê·¸ë˜ì„œ **ë‘˜ ë‹¤ ë§ì¶°ì•¼** "ì‹¤í–‰ë„ ë˜ê³ " "ì—ë””í„°ë„ ì—ëŸ¬ê°€ ì•ˆ ë‚œë‹¤."

---

## 3) TypeScript ê¸°ì´ˆ â€” "ì˜¤ë¥˜ë¥¼ ë¯¸ë¦¬ ì¡ëŠ” ê°œë°œ ë°©ì‹"

### 3.1 TypeScriptëŠ” ë¬´ì—‡ì´ ë‹¤ë¥¸ê°€?

JavaScriptëŠ” ëŸ°íƒ€ì„ì—ì•¼ ì˜¤ë¥˜ê°€ ë“œëŸ¬ë‚˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤.

TypeScriptëŠ” ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì—:
- ë³€ìˆ˜/í•¨ìˆ˜/ë°ì´í„° êµ¬ì¡°ë¥¼ ê²€ì‚¬í•´ì„œ
- ì´ìƒí•œ ë¶€ë¶„ì„ ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œ ê²½ê³ /ì—ëŸ¬ë¡œ ì¡ì•„ì¤€ë‹¤

í•µì‹¬ì€ ì´ê±°ë‹¤:

> TSëŠ” ì‹¤í–‰ ê²°ê³¼ë¥¼ ë°”ê¾¸ëŠ” ì–¸ì–´ê°€ ì•„ë‹ˆë¼,
> ê°œë°œ ì¤‘ ì‹¤ìˆ˜ë¥¼ ì¤„ì—¬ì£¼ëŠ” ë„êµ¬ë‹¤.

### 3.2 "TSë¥¼ ì“°ë ¤ë©´ Nodeê°€ í•„ìš”í•œê°€?"

- ë¸Œë¼ìš°ì €ëŠ” TSë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ê³ , JSë§Œ ì‹¤í–‰í•œë‹¤.
- ê·¸ë˜ì„œ TSëŠ” ê²°êµ­ ë¹Œë“œ ê³¼ì •ì—ì„œ JSë¡œ ë³€í™˜(íŠ¸ëœìŠ¤íŒŒì¼)ëœë‹¤.
- Vite/tsc ê°™ì€ ë„êµ¬ê°€ ë³´í†µ Node ìƒíƒœê³„(npm) ìœ„ì—ì„œ ëŒê¸° ë•Œë¬¸ì— ê°œë°œ/ë¹Œë“œ í™˜ê²½ì—ì„œëŠ” Nodeê°€ í•„ìš”í•˜ë‹¤.

**í•˜ì§€ë§Œ ìš´ì˜(ë°°í¬ í›„ ì‚¬ìš©ì ì‹¤í–‰)ì—ëŠ” Nodeê°€ í•„ìš” ì—†ë‹¤.**
- ì‚¬ìš©ìëŠ” `dist/`ì˜ ì •ì  íŒŒì¼(JS/CSS/HTML)ë§Œ ë°›ëŠ”ë‹¤.
- ê·¸ ì •ì  íŒŒì¼ì€ Nginx ê°™ì€ ì •ì  ì„œë²„ë¡œ ì œê³µ ê°€ëŠ¥í•˜ë‹¤.

### 3.3 tsconfig.json ì˜µì…˜ì„ "ì˜ë¯¸ ê¸°ì¤€"ìœ¼ë¡œ ì´í•´í•˜ê¸°

```json
{
  "compilerOptions": {
    "strict": true,
    "noEmit": true,
    "moduleResolution": "bundler",
    "lib": ["ES2020", "DOM", "DOM.Iterable"]
  }
}
```

- **strict: true** â†’ null ê°€ëŠ¥ì„±, íƒ€ì… ë¶ˆì¼ì¹˜ ê°™ì€ í”í•œ ë²„ê·¸ë¥¼ ê°•í•˜ê²Œ ì¡ëŠ”ë‹¤.
- **noEmit: true** â†’ tscëŠ” "íƒ€ì… ê²€ì‚¬ë§Œ í•˜ê³ " JS íŒŒì¼ì„ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤. (ì‹¤ì œ ë¹Œë“œëŠ” Viteê°€ ë‹´ë‹¹)
- **moduleResolution: "bundler"** â†’ Vite ê°™ì€ ë²ˆë“¤ëŸ¬ í™˜ê²½ì— ë§ê²Œ import í•´ì„ì„ í•œë‹¤.
- **lib: ["DOM", ...]** â†’ ë¸Œë¼ìš°ì € DOM API íƒ€ì…ì„ í¬í•¨í•´ì„œ document, HTMLElement ë“±ì„ ì•Œê²Œ í•œë‹¤.

### 3.4 DOMì—ì„œ TSê°€ íŠ¹íˆ ìœ ìš©í•œ ì´ìœ  (ì˜ˆì‹œ)

ë¸Œë¼ìš°ì € APIëŠ” nullì„ ë¦¬í„´í•  ìˆ˜ ìˆë‹¤.

```typescript
const el = document.getElementById('chat');
```

TS ì…ì¥ì—ì„œëŠ”: `HTMLElement | null`

ê·¸ë˜ì„œ ì‹¤ë¬´ì—ì„œëŠ” ë³´í†µ helperë¡œ ê°•ì œí•œë‹¤:

```typescript
export function getElement<T extends HTMLElement>(id: string): T {
  const el = document.getElementById(id);
  if (!el) throw new Error(`Missing element: #${id}`);
  return el as T;
}
```

ì´ë ‡ê²Œ í•˜ë©´ ì´í›„ ì½”ë“œê°€ ê¹”ë”í•´ì§„ë‹¤:

```typescript
const form = getElement<HTMLFormElement>('chatForm');
form.addEventListener('submit', ...);
```

---

## 4) ìµœì¢… í”„ë¡œì íŠ¸ êµ¬ì¡°

```txt
kid-chat/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ firebase/
â”‚   â”‚   â”œâ”€â”€ config.ts      # Firebase ì´ˆê¸°í™” ë° ì¸ìŠ¤í„´ìŠ¤ export
â”‚   â”‚   â”œâ”€â”€ auth.ts        # ì¸ì¦ ê´€ë ¨ í•¨ìˆ˜ (login, logout, signup ë“±)
â”‚   â”‚   â”œâ”€â”€ chat.ts        # ì±„íŒ… ê´€ë ¨ í•¨ìˆ˜ (ë©”ì‹œì§€ ì „ì†¡, êµ¬ë…, ì‚­ì œ)
â”‚   â”‚   â””â”€â”€ fcm.ts         # FCM í‘¸ì‹œ ì•Œë¦¼ ì´ˆê¸°í™” ë° ê¶Œí•œ ìš”ì²­
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts       # íƒ€ì…/ì¸í„°í˜ì´ìŠ¤ ì •ì˜
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ helpers.ts     # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (formatTime, getNameClass ë“±)
â”‚   â”œâ”€â”€ main.ts            # ì•± ì§„ì…ì  (ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬, UI ë¡œì§)
â”‚   â”œâ”€â”€ styles.css
â”‚   â””â”€â”€ vite-env.d.ts
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ firebase-messaging-sw.js  # ì„œë¹„ìŠ¤ ì›Œì»¤(ë¹Œë“œ ì‹œ ê·¸ëŒ€ë¡œ ë³µì‚¬)
â”‚   â””â”€â”€ img/
â”œâ”€â”€ functions/              # Firebase Cloud Functions (í‘¸ì‹œ ì•Œë¦¼)
â”œâ”€â”€ dist/                   # ë¹Œë“œ ê²°ê³¼ (gitignore)
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ firebase.json
â”œâ”€â”€ firestore.rules
â””â”€â”€ CLAUDE.md               # í”„ë¡œì íŠ¸ ë¬¸ì„œ
```

**src/ vs public/ (ì¤‘ìš” í¬ì¸íŠ¸)**
- **src/**: ë²ˆë“¤ë§ ëŒ€ìƒ (TS/JS/CSS ëª¨ë“ˆ)
- **public/**: ê·¸ëŒ€ë¡œ ì„œë¹™/ë³µì‚¬ë˜ëŠ” ì •ì  íŒŒì¼
- ì„œë¹„ìŠ¤ ì›Œì»¤ëŠ” ê²½ë¡œ/ìŠ¤ì½”í”„ ë¬¸ì œ ë•Œë¬¸ì— public/ì— ë‘ëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì •ì ì´ë‹¤.

---

## 5) Firebaseë€? â€” ë°±ì—”ë“œ ì—†ì´ ì•± ë§Œë“¤ê¸°

### 5.1 Firebaseê°€ ë­”ê°€?

FirebaseëŠ” Googleì´ ì œê³µí•˜ëŠ” **ë°±ì—”ë“œ ì„œë¹„ìŠ¤ í”Œë«í¼(BaaS)** ì´ë‹¤. ì‰½ê²Œ ë§í•˜ë©´, ì„œë²„ë¥¼ ì§ì ‘ ë§Œë“¤ì§€ ì•Šê³ ë„ ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì„ ì“¸ ìˆ˜ ìˆë‹¤:

- **ì¸ì¦(Authentication)**: íšŒì›ê°€ì…, ë¡œê·¸ì¸, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
- **ë°ì´í„°ë² ì´ìŠ¤(Firestore)**: ë©”ì‹œì§€ ì €ì¥, ì‹¤ì‹œê°„ ë™ê¸°í™”
- **í‘¸ì‹œ ì•Œë¦¼(FCM)**: ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼
- **ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜(Cloud Functions)**: ì„œë²„ ë¡œì§ ì‹¤í–‰

> í•œ ë§ˆë””ë¡œ, **"ì„œë²„ ê°œë°œ ì—†ì´ ì•±ì„ ì™„ì„±í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë„êµ¬ ëª¨ìŒ"**ì´ë‹¤.

### 5.2 Kid Chatì—ì„œ Firebaseê°€ í•˜ëŠ” ì¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Kid Chat êµ¬ì¡°ë„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   [ë¸Œë¼ìš°ì €]                         [Firebase]                  â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ë¡œê·¸ì¸ ìš”ì²­    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚  ì‚¬ìš©ì   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  Authentication â”‚            â”‚
â”‚   â”‚  (ë‚˜ìœ¤)   â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  (ì¸ì¦ ì„œë¹„ìŠ¤)    â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    ì¸ì¦ í† í°      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”‚ ë©”ì‹œì§€ ì „ì†¡                                             â”‚
â”‚        â–¼                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ì‹¤ì‹œê°„ ë™ê¸°í™”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ ì±„íŒ… í™”ë©´ â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚   Firestore     â”‚            â”‚
â”‚   â”‚          â”‚                   â”‚  (ë°ì´í„°ë² ì´ìŠ¤)   â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚        â”‚                                â”‚                       â”‚
â”‚        â”‚ ì•Œë¦¼ ìˆ˜ì‹                        â”‚ ìƒˆ ë©”ì‹œì§€ ê°ì§€         â”‚
â”‚        â–¼                                â–¼                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    í‘¸ì‹œ ì•Œë¦¼      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ ì•Œë¦¼ í‘œì‹œ â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ Cloud Functions â”‚            â”‚
â”‚   â”‚          â”‚                   â”‚   + FCM         â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 ê° Firebase ì„œë¹„ìŠ¤ ì—­í• 

| ì„œë¹„ìŠ¤ | ì—­í•  | Kid Chatì—ì„œ í•˜ëŠ” ì¼ |
|--------|------|---------------------|
| **Authentication** | ì‚¬ìš©ì ì¸ì¦ | ê°ìì´ë¦„ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ |
| **Firestore** | NoSQL ë°ì´í„°ë² ì´ìŠ¤ | ì±„íŒ… ë©”ì‹œì§€ ì €ì¥, ì‹¤ì‹œê°„ ë™ê¸°í™” |
| **FCM** | í‘¸ì‹œ ì•Œë¦¼ | ìƒˆ ë©”ì‹œì§€ê°€ ì˜¤ë©´ ì•Œë¦¼ ì „ì†¡ |
| **Cloud Functions** | ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ | ë©”ì‹œì§€ê°€ ì €ì¥ë˜ë©´ ìë™ìœ¼ë¡œ í‘¸ì‹œ ì•Œë¦¼ íŠ¸ë¦¬ê±° |

### 5.4 ì‹¤ì‹œê°„ ë™ê¸°í™”ê°€ ë˜ëŠ” ì´ìœ 

Firestoreì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ëŠ” **ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ(Real-time Listener)** ì´ë‹¤.

```typescript
// ë©”ì‹œì§€ ì»¬ë ‰ì…˜ì„ "êµ¬ë…"í•˜ë©´
onSnapshot(query(collection(db, 'messages'), orderBy('createdAt')), (snapshot) => {
  // ë‹¤ë¥¸ ì‚¬ëŒì´ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë•Œë§ˆë‹¤ ì´ ì½œë°±ì´ ìë™ ì‹¤í–‰ë¨
  snapshot.docChanges().forEach((change) => {
    if (change.type === 'added') {
      // ìƒˆ ë©”ì‹œì§€ í™”ë©´ì— ì¶”ê°€
    }
  });
});
```

ì´ ë°©ì‹ ë•ë¶„ì—:
- ì•„ì´ê°€ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´
- Firebaseê°€ "ë³€ê²½ëë‹¤"ê³  ëª¨ë“  êµ¬ë…ìì—ê²Œ ì•Œë ¤ì£¼ê³ 
- ë¶€ëª¨ í™”ë©´ì— ì¦‰ì‹œ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚œë‹¤

**ì„œë²„ë¥¼ ì§ì ‘ ë§Œë“¤ë©´** WebSocket ì„¤ì •, ì—°ê²° ê´€ë¦¬, ì¬ì—°ê²° ë¡œì§ ë“±ì„ ë‹¤ êµ¬í˜„í•´ì•¼ í•˜ëŠ”ë°, FirestoreëŠ” ì´ê±¸ ë‹¤ í•´ì¤€ë‹¤.

### 5.5 í‘¸ì‹œ ì•Œë¦¼ íë¦„

```
1. ì•„ì´ê°€ ë©”ì‹œì§€ ì „ì†¡
   â†“
2. Firestoreì— ë©”ì‹œì§€ ì €ì¥ë¨
   â†“
3. Cloud Functionsê°€ "ìƒˆ ë©”ì‹œì§€ ìƒì„±" ì´ë²¤íŠ¸ ê°ì§€
   â†“
4. FCMì„ í†µí•´ ë‹¤ë¥¸ ê°€ì¡± ê¸°ê¸°ì— í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡
   â†“
5. ë¶€ëª¨ê°€ íƒœë¸”ë¦¿ì— "ì•„ì´: ì•ˆë…•!" ì•Œë¦¼ í‘œì‹œ
```

ì´ íë¦„ì—ì„œ **Cloud Functions**ê°€ ì¤‘ìš”í•œ ì´ìœ :
- í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ì—ì„œ ì§ì ‘ ë‹¤ë¥¸ ê¸°ê¸°ë¡œ í‘¸ì‹œë¥¼ ë³´ë‚¼ ìˆ˜ ì—†ìŒ
- ì„œë²„ ì¸¡ ì½”ë“œê°€ í•„ìš”í•œë°, Cloud Functionsê°€ ê·¸ ì—­í• ì„ í•¨

---

## 6) í•µì‹¬ ì„¤ì • íŒŒì¼

### 6.1 package.json

```json
{
  "name": "kid-chat",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "firebase": "^10.13.1"
  },
  "devDependencies": {
    "typescript": "^5.6.0",
    "vite": "^6.0.0"
  }
}
```

- **build**: tscë¡œ íƒ€ì… ê²€ì‚¬ â†’ vite buildë¡œ ìµœì í™” ë¹Œë“œ ìƒì„±
- **preview**: ìš´ì˜ í™˜ê²½ì—ì„œ ì •ì  í˜¸ìŠ¤íŒ…ì²˜ëŸ¼ ë™ì‘í•˜ëŠ” ë¡œì»¬/ì„œë²„ ë¯¸ë¦¬ë³´ê¸°

### 6.2 tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "strict": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "noEmit": true,
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src"]
}
```

- **strict: true**: TypeScriptì˜ ì§„ì§œ íš¨ìš©(ì‚¬ê³  ì˜ˆë°©)ì€ ì—¬ê¸°ì„œ ë‚˜ì˜¨ë‹¤.
- **noEmit: true**: tscëŠ” ê²€ì‚¬ ì „ìš©, ì‹¤ì œ ë²ˆë“¤ì€ Viteê°€ ë‹´ë‹¹.
- **paths**: @/ aliasë¥¼ TSê°€ ì´í•´í•˜ë„ë¡ ì„¤ì •.

### 6.3 vite.config.ts

```typescript
import { defineConfig } from 'vite';
import { resolve } from 'path';

export default defineConfig({
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },
  server: {
    host: true,
    port: 3001,
    open: true,
  },
  preview: {
    host: true,
    port: 3001,
    allowedHosts: ['chat.funq.kr'],
  },
  build: {
    outDir: 'dist',
    sourcemap: true,
  },
});
```

- **host: true**: ì™¸ë¶€ ì ‘ì† í—ˆìš©(ê¸°ë³¸ì€ localhost ë°”ì¸ë”©)
- **allowedHosts**: "Blocked request. This host is not allowed" ë°©ì§€

---

## 7) íƒ€ì… ì •ì˜ë¡œ ëª¨ë¸ ê³ ì •í•˜ê¸°

**src/types/index.ts**

```typescript
export interface ChatUser {
  uid: string;
  name: string;
  email: string;
}

export interface Message {
  id: string;
  uid: string;
  name: string;
  text: string;
  createdAt: Date | null;
}

export type NameColorClass =
  | 'color-nayoon'
  | 'color-soyoon'
  | 'color-parent1'
  | 'color-parent2'
  | 'color-parent3';
```

íƒ€ì…ì„ ë¨¼ì € ì¡ì•„ë‘ë©´ ì¢‹ì€ ì :
- Firestore â†’ ì•± ë‚´ë¶€ ëª¨ë¸ë¡œ ë³€í™˜ ë¡œì§ì´ ëª…í™•í•´ì§
- UI ë Œë”ë§/ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì‹¤ìˆ˜ í™• ì¤„ì–´ë“¦

---

## 8) ëª¨ë“ˆ ë¶„ë¦¬ ì„¤ê³„

### Firebase ì„¤ì • (src/firebase/config.ts)
- Firebase ì•± ì´ˆê¸°í™”
- Auth / Firestore / Messaging ì¸ìŠ¤í„´ìŠ¤ export
- VAPID í‚¤ ê´€ë¦¬

### ì¸ì¦ (src/firebase/auth.ts)

| í•¨ìˆ˜ | ì„¤ëª… |
|------|------|
| getCurrentUserName() | í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì´ë¦„ ë°˜í™˜ |
| setCurrentUserName(name) | ì‚¬ìš©ì ì´ë¦„ ì„¤ì • ë° localStorage ì €ì¥ |
| onAuthChange(callback) | ì¸ì¦ ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ |
| signup(name, password) | ê³„ì • ìƒì„± |
| login(name, password) | ë¡œê·¸ì¸ |
| logout() | ë¡œê·¸ì•„ì›ƒ |
| changePassword(current, new) | ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ |

### ì±„íŒ… (src/firebase/chat.ts)

| í•¨ìˆ˜ | ì„¤ëª… |
|------|------|
| subscribeToMessages(callback) | ë©”ì‹œì§€ ì‹¤ì‹œê°„ êµ¬ë… |
| sendMessage(text) | ë©”ì‹œì§€ ì „ì†¡ |
| deleteMessage(messageId) | ë©”ì‹œì§€ ì‚­ì œ |
| parseMessageData(docId, data) | Firestore ë°ì´í„° íŒŒì‹± |

### FCM (src/firebase/fcm.ts)

| í•¨ìˆ˜ | ì„¤ëª… |
|------|------|
| initFCM() | FCM ì´ˆê¸°í™” ë° ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ |
| requestNotificationPermission(userId) | ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ ë° í† í° ì €ì¥ |
| isFcmTokenSaved() | í† í° ì €ì¥ ì—¬ë¶€ í™•ì¸ |

### ìœ í‹¸ (src/utils/helpers.ts)

| í•¨ìˆ˜ | ì„¤ëª… |
|------|------|
| getNameClass(name) | ì´ë¦„ì— ë”°ë¥¸ ìƒ‰ìƒ í´ë˜ìŠ¤ ë°˜í™˜ |
| nameToEmail(name) | ì´ë¦„ì„ ê°€ìƒ ì´ë©”ì¼ë¡œ ë³€í™˜ |
| formatTime(date) | ì‹œê°„ í¬ë§·íŒ… |
| getElement\<T\>(id) | íƒ€ì… ì•ˆì „í•œ DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° |

---

## 9) ì‹¤í–‰ ë°©ë²•

### ê°œë°œ ì„œë²„

```bash
npm run dev
# http://localhost:3001
```

### íƒ€ì… ì²´í¬

```bash
npx tsc --noEmit
```

### í”„ë¡œë•ì…˜ ë¹Œë“œ

```bash
npm run build
# dist/ ìƒì„±
```

### ë¹Œë“œ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°

```bash
npm run preview
```

---

## 10) ë³´ì•ˆ: Firebaseì—ì„œ ì§„ì§œ ë³´ì•ˆì€ Rules

í´ë¼ì´ì–¸íŠ¸ ì„¤ì •(firebaseConfig) ê°’ì€ ë³´í†µ ê³µê°œ ê°€ëŠ¥í•˜ì§€ë§Œ, ê¶Œí•œ ì œì–´ëŠ” Firestore Security Rulesë¡œ í•œë‹¤.

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /messages/{messageId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow delete: if request.auth != null && request.auth.uid == resource.data.uid;
    }
    match /fcmTokens/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

**ì ˆëŒ€ ë…¸ì¶œ ê¸ˆì§€:**
- serviceAccountKey.json
- Firebase Admin SDK ìê²© ì¦ëª…
- í™˜ê²½ ë³€ìˆ˜ì˜ ë¹„ë°€ ê°’

---

## 11) ë²ˆë“¤ í¬ê¸° ë©”ëª¨

```bash
npm run build
```

| íŒŒì¼ | í¬ê¸° | gzip |
|------|------|------|
| index.html | 2.70 KB | 0.93 KB |
| assets/index-*.css | 7.32 KB | 2.17 KB |
| assets/index-*.js | 500.36 KB | 114.97 KB |

Firebase SDK í¬í•¨ìœ¼ë¡œ JS ë²ˆë“¤ì´ í° í¸ì´ë¼, í•„ìš”í•˜ë©´ ë™ì  importë¡œ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…ì„ ê³ ë ¤í•  ìˆ˜ ìˆë‹¤.

---

## 12) ìš´ì˜ ë°°í¬: Ubuntu + Nginx + PM2 + HTTPS

### 12.1 Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •

**/etc/nginx/sites-available/chat.conf**

```bash
sudo tee /etc/nginx/sites-available/chat.conf << 'EOF'
server {
    listen 80;
    server_name chat.funq.kr;

    location / {
        proxy_pass http://127.0.0.1:3001;
        proxy_http_version 1.1;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
EOF
```

ì ìš©:

```bash
sudo ln -s /etc/nginx/sites-available/chat.conf /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx
```

> heredoc ì‚¬ìš© ì‹œ EOFëŠ” ì¤„ ë§¨ ì•ì— ìˆì–´ì•¼ í•œë‹¤(ë“¤ì—¬ì“°ê¸° ê¸ˆì§€).

### 12.2 PM2ë¡œ preview ìš´ì˜

```bash
npm install
npm run build
pm2 start npm --name "kid-chat" -- run preview
```

PM2 ìì£¼ ì“°ëŠ” ëª…ë ¹ì–´:

```bash
pm2 logs kid-chat
pm2 restart kid-chat
pm2 status
pm2 save
pm2 startup
```

### 12.3 ë°©í™”ë²½(UFW)

```bash
ss -tlnp | grep 3001
sudo ufw allow 3001
```

### 12.4 HTTPS (Let's Encrypt)

```bash
sudo certbot --nginx -d chat.funq.kr
```

Certbotì´ ìë™ìœ¼ë¡œ:
- ì¸ì¦ì„œ ë°œê¸‰
- HTTPS ì„¤ì • ì¶”ê°€
- HTTP â†’ HTTPS ë¦¬ë‹¤ì´ë ‰íŠ¸
- ìë™ ê°±ì‹  ìŠ¤ì¼€ì¤„ ë“±ë¡

---

## 13) ìš´ì˜ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 13.1 "Blocked request. This host is not allowed"

Viteì˜ ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ Hostê°€ í—ˆìš©ë˜ì§€ ì•Šìœ¼ë©´ ì°¨ë‹¨ëœë‹¤.
â†’ vite.config.tsì˜ preview.allowedHostsì— ë„ë©”ì¸ì„ ì¶”ê°€.

### 13.2 ì™¸ë¶€ì—ì„œ ì ‘ì†ì´ ì•ˆ ë¨

1. `host: true` ì„¤ì • í™•ì¸
2. ë°©í™”ë²½(`sudo ufw status`) í™•ì¸
3. í¬íŠ¸ ë¦¬ìŠ¤ë‹ í™•ì¸: `ss -tlnp | grep 3001`

---

## 14) CI/CD ì•ˆë‚´

CI/CDëŠ” ì•„ë˜ ê¸€ì—ì„œ ì •ë¦¬í•œ ë°©ì‹ ê·¸ëŒ€ë¡œ ì ìš©í–ˆë‹¤.
- https://blog.funq.kr/blogs/cicd-setup-20251216-v01

(ì´ ê¸€ì˜ íë¦„ëŒ€ë¡œ êµ¬ì„±í•˜ë©´, ë¹Œë“œ/ë°°í¬/PM2 ì¬ì‹œì‘ê¹Œì§€ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°ëœë‹¤.)

---

## 15) ë§ˆë¬´ë¦¬

ì´ë²ˆ ì‘ì—…ì˜ ìˆ˜í™•ì€ "í”„ë ˆì„ì›Œí¬ ì´ì „ì— ê°–ì¶°ì•¼ í•  ê¸°ë³¸ê¸°"ë¥¼ ì‹¤ì œ ì„œë¹„ìŠ¤ì— ì ìš©í•´ë´¤ë‹¤ëŠ” ì ì´ë‹¤.

- ëª¨ë“ˆ ë¶„ë¦¬ë¡œ ì½”ë“œ ì´í•´/ìˆ˜ì • ë²”ìœ„ê°€ ì‘ì•„ì§
- strict TSë¡œ ì‹¤ìˆ˜ ëŒ€ë¶€ë¶„ì„ ê°œë°œ ë‹¨ê³„ì—ì„œ ì°¨ë‹¨
- Viteë¡œ ê°œë°œ ì†ë„(HMR) + ë°°í¬ ë¹Œë“œê¹Œì§€ í•œ ë²ˆì— í•´ê²°
- ìš´ì˜ ë°°í¬ê¹Œì§€ ëë‚´ì„œ "ì‹¤ì‚¬ìš© ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤"ê°€ ë¨

---

ê·¸ë¦¬ê³  ê°€ì¥ ì¤‘ìš”í•œ ê±´, **ì•„ì´ë“¤ì´ ì´ì œ íƒœë¸”ë¦¿ìœ¼ë¡œ "ì•„ë¹  ì‚¬ë‘í•´!" ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆê²Œ ëë‹¤ëŠ” ê²ƒ**ì´ë‹¤.

